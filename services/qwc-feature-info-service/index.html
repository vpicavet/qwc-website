<!doctype html><html lang=en class="js csstransforms3d"><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=generator content="Hugo 0.68.3"><meta name=description content="Documentation QWC2 and QWC services"><link rel="shortcut icon" href=/images/favicon.ico type=image/x-icon><title>QWC FeatureInfo Service :: QWC2 Documentation</title><link href=/css/nucleus.css?1632385178 rel=stylesheet><link href=/css/fontawesome-all.min.css?1632385178 rel=stylesheet><link href=/css/hybrid.css?1632385178 rel=stylesheet><link href=/css/featherlight.min.css?1632385178 rel=stylesheet><link href=/css/perfect-scrollbar.min.css?1632385178 rel=stylesheet><link href=/css/auto-complete.css?1632385178 rel=stylesheet><link href=/css/atom-one-dark-reasonable.css?1632385178 rel=stylesheet><link href=/css/theme.css?1632385178 rel=stylesheet><link href=/css/tabs.css?1632385178 rel=stylesheet><link href=/css/hugo-theme.css?1632385178 rel=stylesheet><link href=/css/theme-green.css?1632385178 rel=stylesheet><script src=/js/jquery-3.3.1.min.js?1632385178></script><style>:root #header+#content>#left>#rlblock_left{display:none!important}</style></head><body data-url=/services/qwc-feature-info-service/><nav id=sidebar><div id=header-wrapper><div id=header><a id=logo href><img src=/images/qwc-logo.png height=50></a></div><div class=searchbox><label for=search-by><i class="fas fa-search"></i></label><input data-search-input id=search-by type=search placeholder=Search...>
<span data-search-clear><i class="fas fa-times"></i></span></div><script type=text/javascript src=/js/lunr.min.js?1632385178></script><script type=text/javascript src=/js/auto-complete.js?1632385178></script><script type=text/javascript>var baseurl="https:\/\/qwc.sourcepole.com\/";</script><script type=text/javascript src=/js/search.js?1632385178></script></div><section id=homelinks><ul><li><a class=padding href=/><i class="fas fa-home"></i>Home</a></li></ul></section><div class=highlightable><ul class=topics><li data-nav-id=/overview/ title=Overview class=dd-item><a href=/overview/>Overview</a></li><li data-nav-id=/quick-start/ title="Quick Start" class=dd-item><a href=/quick-start/>Quick Start</a></li><li data-nav-id=/configuration/ title=Configuration class=dd-item><a href=/configuration/>Configuration</a></li><li data-nav-id=/viewer/ title="QGIS Web Client 2" class=dd-item><a href=/viewer/>Viewer</a></li><li data-nav-id=/services/ title=Services class="dd-item
parent"><a href=/services/>Services</a><ul><li data-nav-id=/services/qwc-map-viewer/ title="QWC Map Viewer Service" class=dd-item><a href=/services/qwc-map-viewer/>qwc-map-viewer</a></li><li data-nav-id=/services/qwc-ogc-service/ title="QWC OGC Service" class=dd-item><a href=/services/qwc-ogc-service/>qwc-ogc-service</a></li><li data-nav-id=/services/qwc-feature-info-service/ title="QWC FeatureInfo Service" class="dd-item active"><a href=/services/qwc-feature-info-service/>qwc-feature-info-service</a></li><li data-nav-id=/services/qwc-fulltext-search-service/ title="QWC Fulltext Search Service" class=dd-item><a href=/services/qwc-fulltext-search-service/>qwc-fulltext-search-service</a></li><li data-nav-id=/services/qwc-legend-service/ title="QWC Legend Service" class=dd-item><a href=/services/qwc-legend-service/>qwc-legend-service</a></li><li data-nav-id=/services/qwc-permalink-service/ title="QWC Permalink Service" class=dd-item><a href=/services/qwc-permalink-service/>qwc-permalink-service</a></li><li data-nav-id=/services/qwc-print-service/ title="QWC Print service" class=dd-item><a href=/services/qwc-print-service/>qwc-print-service</a></li><li data-nav-id=/services/qwc-mapinfo-service/ title="QWC MapInfo Service" class=dd-item><a href=/services/qwc-mapinfo-service/>qwc-mapinfo-service</a></li><li data-nav-id=/services/qwc-data-service/ title="QWC Data Service" class=dd-item><a href=/services/qwc-data-service/>qwc-data-service</a></li><li data-nav-id=/services/qwc-document-service/ title="Document service" class=dd-item><a href=/services/qwc-document-service/>qwc-document-service</a></li><li data-nav-id=/services/qwc-elevation-service/ title="QWC Elevation Service" class=dd-item><a href=/services/qwc-elevation-service/>qwc-elevation-service</a></li><li data-nav-id=/services/qwc-admin-gui/ title="QWC Admin GUI" class=dd-item><a href=/services/qwc-admin-gui/>qwc-admin-gui</a></li><li data-nav-id=/services/qwc-registration-gui/ title="Registration GUI" class=dd-item><a href=/services/qwc-registration-gui/>qwc-registration-gui</a></li><li data-nav-id=/services/qwc-config-generator/ title="QWC Config Generator" class=dd-item><a href=/services/qwc-config-generator/>qwc-config-generator</a></li></ul></li><li data-nav-id=/authentication/ title=Authentication class=dd-item><a href=/authentication/>Authentication</a><ul><li data-nav-id=/authentication/qwc-db-auth/ title="DB Authentication Service" class=dd-item><a href=/authentication/qwc-db-auth/>qwc-db-auth</a></li><li data-nav-id=/authentication/qwc-ldap-auth/ title="LDAP Authentication Service" class=dd-item><a href=/authentication/qwc-ldap-auth/>qwc-ldap-auth</a></li></ul></li></ul><section id=footer></section></div></nav><section id=body><div id=overlay></div><div class="padding highlightable"><div><div id=top-bar><div id=top-github-link><a class=github-link title="Edit this page" href=https://github.com/qwc-services/qwc-website/edit/main/content/services/qwc-feature-info-service.md target=blank><i class="fas fa-code-branch"></i><span id=top-github-link-text>Edit this page</span></a></div><div id=breadcrumbs itemscope itemtype=http://data-vocabulary.org/Breadcrumb><span id=sidebar-toggle-span><a href=# id=sidebar-toggle data-sidebar-toggle><i class="fas fa-bars"></i></a></span><span id=toc-menu><i class="fas fa-list-alt"></i></span><span class=links><a href=/>QWC2 / QWC Services</a> > <a href=/services/>Services</a> > QWC FeatureInfo Service</span></div><div class=progress><div class=wrapper><nav id=TableOfContents><ul><li><a href=#setup>Setup</a><ul><li><a href=#qwc_demo-example>qwc_demo example</a></li></ul></li><li><a href=#configuration>Configuration</a><ul><li><a href=#featureinfo-service-config>FeatureInfo Service config</a></li><li><a href=#permissions>Permissions</a></li></ul></li><li><a href=#html-template>HTML template</a><ul><li><a href=#default-info-template>Default info template</a></li></ul></li><li><a href=#db-query>DB Query</a></li><li><a href=#custom-info-modules>Custom info modules</a></li><li><a href=#usage>Usage</a></li><li><a href=#docker-usage>Docker usage</a></li><li><a href=#development>Development</a></li></ul></nav></div></div></div></div><div id=head-tags></div><div id=body-inner><h1>QWC FeatureInfo Service</h1><p>Query layers at a geographic position using an API based on WMS GetFeatureInfo.</p><p>The query is handled for each layer by its layer info provider configured in the config file.</p><p>Layer info providers:</p><ul><li>WMS GetFeatureInfo (default): forward info request to the QGIS Server</li><li>DB Query: execute custom query SQL</li><li>Custom info module: custom Python modules returning layer info</li></ul><p>The info results are each rendered into customizable HTML templates and returned as a GetFeatureInfoResponse XML.</p><h2 id=setup>Setup</h2><p>The DB query uses a PostgreSQL connection service or connection to a PostGIS database.
This connection&rsquo;s user requires read access to the configured tables.</p><h3 id=qwc_demo-example>qwc_demo example</h3><p>Uses PostgreSQL connection service <code>qwc_geodb</code> (GeoDB).
The user <code>qwc_service</code> requires read access to the configured tables
of the data layers from the QGIS project <code>qwc_demo.qgs</code>.</p><p>Setup PostgreSQL connection service file <code>~/.pg_service.conf</code>:</p><pre><code>host=localhost
port=5439
dbname=qwc_demo
user=qwc_service
password=qwc_service
sslmode=disable
</code></pre><h2 id=configuration>Configuration</h2><p>The static config and permission files are stored as JSON files in <code>$CONFIG_PATH</code> with subdirectories for each tenant,
e.g. <code>$CONFIG_PATH/default/*.json</code>. The default tenant name is <code>default</code>.</p><p>Environment variables:</p><ul><li><code>SKIP_EMPTY_ATTRIBUTES=&lt;boolean></code>: Whether to skip empty featureinfo attributes returned by WMS GetFeatureInfo.</li><li><code>USE_PERMISSION_ATTRIBUTE_ORDER=&lt;boolean></code>: Whether to order the attributes according to order of the permitted attribute names, rather than the order returned by WMS GetFeatureInfo.</li></ul><h3 id=featureinfo-service-config>FeatureInfo Service config</h3><ul><li><a href=schemas/qwc-feature-info-service.json>JSON schema</a></li><li>File location: <code>$CONFIG_PATH/&lt;tenant>/featureInfoConfig.json</code></li></ul><p>Example:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json>{
  <span style=color:#f92672>&#34;$schema&#34;</span>: <span style=color:#e6db74>&#34;https://raw.githubusercontent.com/qwc-services/qwc-feature-info-service/master/schemas/qwc-feature-info-service.json&#34;</span>,
  <span style=color:#f92672>&#34;service&#34;</span>: <span style=color:#e6db74>&#34;feature-info&#34;</span>,
  <span style=color:#f92672>&#34;config&#34;</span>: {
    <span style=color:#f92672>&#34;default_qgis_server_url&#34;</span>: <span style=color:#e6db74>&#34;http://localhost:8001/ows/&#34;</span>
  },
  <span style=color:#f92672>&#34;resources&#34;</span>: {
    <span style=color:#f92672>&#34;wms_services&#34;</span>: [
      {
        <span style=color:#f92672>&#34;name&#34;</span>: <span style=color:#e6db74>&#34;qwc_demo&#34;</span>,
        <span style=color:#f92672>&#34;root_layer&#34;</span>: {
          <span style=color:#f92672>&#34;name&#34;</span>: <span style=color:#e6db74>&#34;qwc_demo&#34;</span>,
          <span style=color:#f92672>&#34;layers&#34;</span>: [
            {
              <span style=color:#f92672>&#34;name&#34;</span>: <span style=color:#e6db74>&#34;edit_demo&#34;</span>,
              <span style=color:#f92672>&#34;title&#34;</span>: <span style=color:#e6db74>&#34;Edit Demo&#34;</span>,
              <span style=color:#f92672>&#34;layers&#34;</span>: [
                {
                  <span style=color:#f92672>&#34;name&#34;</span>: <span style=color:#e6db74>&#34;edit_points&#34;</span>,
                  <span style=color:#f92672>&#34;title&#34;</span>: <span style=color:#e6db74>&#34;Edit Points&#34;</span>,
                  <span style=color:#f92672>&#34;attributes&#34;</span>: [
                    {
                      <span style=color:#f92672>&#34;name&#34;</span>: <span style=color:#e6db74>&#34;id&#34;</span>
                    },
                    {
                      <span style=color:#f92672>&#34;name&#34;</span>: <span style=color:#e6db74>&#34;name&#34;</span>
                    },
                    {
                      <span style=color:#f92672>&#34;name&#34;</span>: <span style=color:#e6db74>&#34;description&#34;</span>
                    },
                    {
                      <span style=color:#f92672>&#34;name&#34;</span>: <span style=color:#e6db74>&#34;num&#34;</span>
                    },
                    {
                      <span style=color:#f92672>&#34;name&#34;</span>: <span style=color:#e6db74>&#34;value&#34;</span>
                    },
                    {
                      <span style=color:#f92672>&#34;name&#34;</span>: <span style=color:#e6db74>&#34;type&#34;</span>
                    },
                    {
                      <span style=color:#f92672>&#34;name&#34;</span>: <span style=color:#e6db74>&#34;amount&#34;</span>
                    },
                    {
                      <span style=color:#f92672>&#34;name&#34;</span>: <span style=color:#e6db74>&#34;validated&#34;</span>,
                      <span style=color:#f92672>&#34;format&#34;</span>: <span style=color:#e6db74>&#34;{\&#34;t\&#34;: \&#34;Yes\&#34;, \&#34;f\&#34;: \&#34;No\&#34;}&#34;</span>
                    },
                    {
                      <span style=color:#f92672>&#34;name&#34;</span>: <span style=color:#e6db74>&#34;datetime&#34;</span>
                    },
                    {
                      <span style=color:#f92672>&#34;name&#34;</span>: <span style=color:#e6db74>&#34;geometry&#34;</span>
                    },
                    {
                      <span style=color:#f92672>&#34;name&#34;</span>: <span style=color:#e6db74>&#34;maptip&#34;</span>
                    }
                  ]
                }
              ]
            },
            {
              <span style=color:#f92672>&#34;name&#34;</span>: <span style=color:#e6db74>&#34;countries&#34;</span>,
              <span style=color:#f92672>&#34;title&#34;</span>: <span style=color:#e6db74>&#34;Countries&#34;</span>,
              <span style=color:#f92672>&#34;attributes&#34;</span>: [
                {
                  <span style=color:#f92672>&#34;name&#34;</span>: <span style=color:#e6db74>&#34;name&#34;</span>,
                  <span style=color:#f92672>&#34;alias&#34;</span>: <span style=color:#e6db74>&#34;Name&#34;</span>
                },
                {
                  <span style=color:#f92672>&#34;name&#34;</span>: <span style=color:#e6db74>&#34;formal_en&#34;</span>,
                  <span style=color:#f92672>&#34;alias&#34;</span>: <span style=color:#e6db74>&#34;Formal name&#34;</span>
                },
                {
                  <span style=color:#f92672>&#34;name&#34;</span>: <span style=color:#e6db74>&#34;pop_est&#34;</span>,
                  <span style=color:#f92672>&#34;alias&#34;</span>: <span style=color:#e6db74>&#34;Population&#34;</span>
                },
                {
                  <span style=color:#f92672>&#34;name&#34;</span>: <span style=color:#e6db74>&#34;subregion&#34;</span>,
                  <span style=color:#f92672>&#34;alias&#34;</span>: <span style=color:#e6db74>&#34;Subregion&#34;</span>
                },
                {
                  <span style=color:#f92672>&#34;name&#34;</span>: <span style=color:#e6db74>&#34;geometry&#34;</span>
                }
              ],
              <span style=color:#f92672>&#34;display_field&#34;</span>: <span style=color:#e6db74>&#34;name&#34;</span>,
              <span style=color:#f92672>&#34;info_template&#34;</span>: {
                <span style=color:#f92672>&#34;type&#34;</span>: <span style=color:#e6db74>&#34;wms&#34;</span>,
                <span style=color:#f92672>&#34;wms_url&#34;</span>: <span style=color:#e6db74>&#34;http://localhost:8001/ows/qwc_demo&#34;</span>,
                <span style=color:#f92672>&#34;template&#34;</span>: <span style=color:#e6db74>&#34;&lt;div&gt;&lt;h2&gt;Demo Template&lt;/h2&gt;Pos: {{ x }}, {{ y }}&lt;br&gt;Name: {{ feature.Name }}&lt;/div&gt;&#34;</span>
              }
            }
          ]
        }
      }
    ]
  }
}
</code></pre></div><p>Example <code>info_template</code> for WMS GetFeatureInfo:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=color:#e6db74>&#34;info_template&#34;</span><span style=color:#960050;background-color:#1e0010>:</span> {
  <span style=color:#f92672>&#34;type&#34;</span>: <span style=color:#e6db74>&#34;wms&#34;</span>,
  <span style=color:#f92672>&#34;wms_url&#34;</span>: <span style=color:#e6db74>&#34;http://localhost:8001/ows/qwc_demo&#34;</span>,
  <span style=color:#f92672>&#34;template&#34;</span>: <span style=color:#e6db74>&#34;&lt;div&gt;&lt;h2&gt;Demo Template&lt;/h2&gt;Pos: {{ x }}, {{ y }}&lt;br&gt;Name: {{ feature.Name }}&lt;/div&gt;&#34;</span>
}
</code></pre></div><p>Example <code>info_template</code> for DB query:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=color:#e6db74>&#34;info_template&#34;</span><span style=color:#960050;background-color:#1e0010>:</span> {
  <span style=color:#f92672>&#34;type&#34;</span>: <span style=color:#e6db74>&#34;sql&#34;</span>,
  <span style=color:#f92672>&#34;db_url&#34;</span>: <span style=color:#e6db74>&#34;postgresql:///?service=qwc_geodb&#34;</span>,
  <span style=color:#f92672>&#34;sql&#34;</span>: <span style=color:#e6db74>&#34;SELECT ogc_fid as _fid_, name, formal_en, pop_est, subregion, ST_AsText(wkb_geometry) as wkt_geom FROM qwc_geodb.ne_10m_admin_0_countries WHERE ST_Intersects(wkb_geometry, ST_GeomFromText(:geom, :srid)) LIMIT :feature_count;&#34;</span>,
  <span style=color:#f92672>&#34;template&#34;</span>: <span style=color:#e6db74>&#34;&lt;div&gt;&lt;h2&gt;Demo Template&lt;/h2&gt;Pos: {{ x }}, {{ y }}&lt;br&gt;Name: {{ feature.Name }}&lt;/div&gt;&#34;</span>
}
</code></pre></div><p>Note: <code>x</code>, <code>y</code> and <code>geom</code> are passed as parameters to the SQL query. If a <code>GetFeatureInfo</code> request is being processed with a <code>filter_geom</code> parameter, <code>geom</code> will correspond to that parameter. Otherwise <code>geom</code> will be <code>POINT(x y)</code>.</p><p>Example <code>info_template</code> for Custom info module:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=color:#e6db74>&#34;info_template&#34;</span><span style=color:#960050;background-color:#1e0010>:</span> {
  <span style=color:#f92672>&#34;type&#34;</span>: <span style=color:#e6db74>&#34;module&#34;</span>,
  <span style=color:#f92672>&#34;module&#34;</span>: <span style=color:#e6db74>&#34;example&#34;</span>,
  <span style=color:#f92672>&#34;template&#34;</span>: <span style=color:#e6db74>&#34;&lt;div&gt;&lt;h2&gt;Demo Template&lt;/h2&gt;Pos: {{ x }}, {{ y }}&lt;br&gt;Name: {{ feature.Name }}&lt;/div&gt;&#34;</span>
}
</code></pre></div><h4 id=base64-encoded-properties>Base64 encoded properties</h4><p>The following config properties may also be set as Base64 encoded values instead:</p><ul><li>Default HTML info template: <code>default_info_template_base64</code></li><li>Formatting expression for converting attribute values: <code>format_base64</code></li><li>HTML template for info result: <code>template_base64</code></li><li>Query SQL for DB query: <code>sql_base64</code></li></ul><p>Any plain text properties take precedence over their corresponding Base64 encoded property (e.g. <code>template_base64</code> is only used if <code>template</code> is not set).</p><h3 id=permissions>Permissions</h3><ul><li><a href=https://github.com/qwc-services/qwc-services-core/blob/master/schemas/qwc-services-permissions.json>JSON schema</a></li><li>File location: <code>$CONFIG_PATH/&lt;tenant>/permissions.json</code></li></ul><p>Example:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json>{
  <span style=color:#f92672>&#34;$schema&#34;</span>: <span style=color:#e6db74>&#34;https://raw.githubusercontent.com/qwc-services/qwc-services-core/master/schemas/qwc-services-permissions.json&#34;</span>,
  <span style=color:#f92672>&#34;users&#34;</span>: [
    {
      <span style=color:#f92672>&#34;name&#34;</span>: <span style=color:#e6db74>&#34;demo&#34;</span>,
      <span style=color:#f92672>&#34;groups&#34;</span>: [<span style=color:#e6db74>&#34;demo&#34;</span>],
      <span style=color:#f92672>&#34;roles&#34;</span>: []
    }
  ],
  <span style=color:#f92672>&#34;groups&#34;</span>: [
    {
      <span style=color:#f92672>&#34;name&#34;</span>: <span style=color:#e6db74>&#34;demo&#34;</span>,
      <span style=color:#f92672>&#34;roles&#34;</span>: [<span style=color:#e6db74>&#34;demo&#34;</span>]
    }
  ],
  <span style=color:#f92672>&#34;roles&#34;</span>: [
    {
      <span style=color:#f92672>&#34;role&#34;</span>: <span style=color:#e6db74>&#34;public&#34;</span>,
      <span style=color:#f92672>&#34;permissions&#34;</span>: {
        <span style=color:#f92672>&#34;wms_services&#34;</span>: [
          {
            <span style=color:#f92672>&#34;name&#34;</span>: <span style=color:#e6db74>&#34;qwc_demo&#34;</span>,
            <span style=color:#f92672>&#34;ows_type&#34;</span>: <span style=color:#e6db74>&#34;WMS&#34;</span>,
            <span style=color:#f92672>&#34;layers&#34;</span>: [
              {
                <span style=color:#f92672>&#34;name&#34;</span>: <span style=color:#e6db74>&#34;qwc_demo&#34;</span>
              },
              {
                <span style=color:#f92672>&#34;name&#34;</span>: <span style=color:#e6db74>&#34;edit_demo&#34;</span>
              },
              {
                <span style=color:#f92672>&#34;name&#34;</span>: <span style=color:#e6db74>&#34;edit_points&#34;</span>,
                <span style=color:#f92672>&#34;attributes&#34;</span>: [
                  <span style=color:#e6db74>&#34;id&#34;</span>, <span style=color:#e6db74>&#34;name&#34;</span>, <span style=color:#e6db74>&#34;description&#34;</span>, <span style=color:#e6db74>&#34;num&#34;</span>, <span style=color:#e6db74>&#34;value&#34;</span>, <span style=color:#e6db74>&#34;type&#34;</span>, <span style=color:#e6db74>&#34;amount&#34;</span>, <span style=color:#e6db74>&#34;validated&#34;</span>,
                  <span style=color:#e6db74>&#34;datetime&#34;</span>, <span style=color:#e6db74>&#34;geometry&#34;</span>, <span style=color:#e6db74>&#34;maptip&#34;</span>
                ]
              },
              {
                <span style=color:#f92672>&#34;name&#34;</span>: <span style=color:#e6db74>&#34;countries&#34;</span>,
                <span style=color:#f92672>&#34;attributes&#34;</span>: [<span style=color:#e6db74>&#34;name&#34;</span>, <span style=color:#e6db74>&#34;formal_en&#34;</span>, <span style=color:#e6db74>&#34;pop_est&#34;</span>, <span style=color:#e6db74>&#34;subregion&#34;</span>, <span style=color:#e6db74>&#34;geometry&#34;</span>],
                <span style=color:#f92672>&#34;info_template&#34;</span>: <span style=color:#66d9ef>true</span>
              }
            ]
          }
        ]
      }
    }
  ]
}
</code></pre></div><h2 id=html-template>HTML template</h2><p>A HTML template can be provided for a layer in the config file.
The template must only contain the body content (without <code>head</code>, <code>script</code>, <code>body</code>).
The HTML can be styled using inline CSS, otherwise the CSS from the QWC viewer is used.</p><p>This template can contain attribute value placeholders, in the form</p><pre><code>{{ feature.attr }}
</code></pre><p>which are replaced with the respective values when the template is rendered (using <a href=http://jinja.pocoo.org/>Jinja2</a>).
The following values are available in the template:</p><ul><li><code>x</code>, <code>y</code>, <code>crs</code>: Coordinates and CRS of info query</li><li><code>feature</code>: Feature with attributes from info result as properties, e.g. <code>feature.name</code></li><li><code>fid</code>: Feature ID (if present)</li><li><code>bbox</code>: Feature bounding box as <code>[&lt;minx>, &lt;miny>, &lt;maxx>, &lt;maxy>]</code> (if present)</li><li><code>geometry</code>: Feature geometry as WKT (if present)</li><li><code>layer</code>: Layer name</li></ul><p>To automatically detect hyperlinks in values and replace them as HTML links the following helper can be used in the template:</p><pre><code>render_value(value)
</code></pre><p>Example:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml>    <span style=color:#f92672>&lt;div&gt;</span>Result at coordinates {{ x }}, {{ y }}<span style=color:#f92672>&lt;/div&gt;</span>
    <span style=color:#f92672>&lt;table&gt;</span>
        <span style=color:#f92672>&lt;tr&gt;</span>
            <span style=color:#f92672>&lt;td&gt;</span>Name:<span style=color:#f92672>&lt;/td&gt;</span>
            <span style=color:#f92672>&lt;td&gt;</span>{{ feature.name }}<span style=color:#f92672>&lt;/td&gt;</span>
        <span style=color:#f92672>&lt;/tr&gt;</span>
        <span style=color:#f92672>&lt;tr&gt;</span>
            <span style=color:#f92672>&lt;td&gt;</span>Description:<span style=color:#f92672>&lt;/td&gt;</span>
            <span style=color:#f92672>&lt;td&gt;</span>{{ feature.description }}<span style=color:#f92672>&lt;/td&gt;</span>
        <span style=color:#f92672>&lt;/tr&gt;</span>
    <span style=color:#f92672>&lt;/table&gt;</span>
</code></pre></div><h3 id=default-info-template>Default info template</h3><p>Layers with no assigned info templates use WMS GetFeatureInfo with a default info template.
The default template can also optionally be configured as <code>default_info_template</code> in the config file.</p><p>The InfoFeature <code>feature</code> available in the template also provides a list of its attributes:</p><pre><code>feature._attributes = [
    'name': &lt;attribute name&gt;,
    'value': &lt;attribute value&gt;,
    'alias': &lt;attribute alias&gt;,
    'type': &lt;attribute value data type as string&gt;,
    'json_aliases': &lt;JSON attribute aliases as {'json_key': 'value'}&gt;
]
</code></pre><p>If an attribute value starts with <code>{</code> or <code>[</code> the service tries to parse it as JSON before rendering it in the template.</p><p>Default info template:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml>    <span style=color:#f92672>&lt;table</span> <span style=color:#a6e22e>class=</span><span style=color:#e6db74>&#34;attribute-list&#34;</span><span style=color:#f92672>&gt;</span>
        <span style=color:#f92672>&lt;tbody&gt;</span>
        {% for attr in feature._attributes -%}
            {% if attr[&#39;type&#39;] == &#39;list&#39; -%}
                {# attribute is a list #}
                <span style=color:#f92672>&lt;tr&gt;</span>
                    <span style=color:#f92672>&lt;td</span> <span style=color:#a6e22e>class=</span><span style=color:#e6db74>&#34;identify-attr-title wrap&#34;</span><span style=color:#f92672>&gt;&lt;i&gt;</span>{{ attr[&#39;alias&#39;] }}<span style=color:#f92672>&lt;/i&gt;&lt;/td&gt;</span>
                    <span style=color:#f92672>&lt;td&gt;</span>
                        <span style=color:#f92672>&lt;table</span> <span style=color:#a6e22e>class=</span><span style=color:#e6db74>&#34;identify-attr-subtable&#34;</span><span style=color:#f92672>&gt;</span>
                            <span style=color:#f92672>&lt;tbody&gt;</span>
                            {%- for item in attr[&#39;value&#39;] %}
                                    {%- if item is mapping -%}
                                        {# item is a dict #}
                                        {% for key in item -%}
                                            {% if not attr[&#39;json_aliases&#39;] %}
                                                {% set alias = key %}
                                            {% elif key in attr[&#39;json_aliases&#39;] %}
                                                {% set alias = attr[&#39;json_aliases&#39;][key] %}
                                            {% endif %}
                                            {% if alias %}
                                                <span style=color:#f92672>&lt;tr&gt;</span>
                                                    <span style=color:#f92672>&lt;td</span> <span style=color:#a6e22e>class=</span><span style=color:#e6db74>&#34;identify-attr-title wrap&#34;</span><span style=color:#f92672>&gt;</span>
                                                        <span style=color:#f92672>&lt;i&gt;</span>{{ alias }}<span style=color:#f92672>&lt;/i&gt;</span>
                                                    <span style=color:#f92672>&lt;/td&gt;</span>
                                                    <span style=color:#f92672>&lt;td</span> <span style=color:#a6e22e>class=</span><span style=color:#e6db74>&#34;identify-attr-value wrap&#34;</span><span style=color:#f92672>&gt;</span>
                                                        {{ render_value(item[key]) }}
                                                    <span style=color:#f92672>&lt;/td&gt;</span>
                                                <span style=color:#f92672>&lt;/tr&gt;</span>
                                            {% endif %}
                                        {%- endfor %}
                                    {%- else -%}
                                        <span style=color:#f92672>&lt;tr&gt;</span>
                                            <span style=color:#f92672>&lt;td</span> <span style=color:#a6e22e>class=</span><span style=color:#e6db74>&#34;identify-attr-value identify-attr-single-value wrap&#34;</span> <span style=color:#a6e22e>colspan=</span><span style=color:#e6db74>&#34;2&#34;</span><span style=color:#f92672>&gt;</span>
                                                {{ render_value(item) }}
                                            <span style=color:#f92672>&lt;/td&gt;</span>
                                        <span style=color:#f92672>&lt;/tr&gt;</span>
                                    {%- endif %}
                                    <span style=color:#f92672>&lt;tr&gt;</span>
                                        <span style=color:#f92672>&lt;td</span> <span style=color:#a6e22e>class=</span><span style=color:#e6db74>&#34;identify-attr-spacer&#34;</span> <span style=color:#a6e22e>colspan=</span><span style=color:#e6db74>&#34;2&#34;</span><span style=color:#f92672>&gt;&lt;/td&gt;</span>
                                    <span style=color:#f92672>&lt;/tr&gt;</span>
                            {%- endfor %}
                            <span style=color:#f92672>&lt;/tbody&gt;</span>
                        <span style=color:#f92672>&lt;/table&gt;</span>
                    <span style=color:#f92672>&lt;/td&gt;</span>
                <span style=color:#f92672>&lt;/tr&gt;</span>

            {%- elif attr[&#39;type&#39;] in [&#39;dict&#39;, &#39;OrderedDict&#39;] -%}
                {# attribute is a dict #}
                <span style=color:#f92672>&lt;tr&gt;</span>
                    <span style=color:#f92672>&lt;td</span> <span style=color:#a6e22e>class=</span><span style=color:#e6db74>&#34;identify-attr-title wrap&#34;</span><span style=color:#f92672>&gt;&lt;i&gt;</span>{{ attr[&#39;alias&#39;] }}<span style=color:#f92672>&lt;/i&gt;&lt;/td&gt;</span>
                    <span style=color:#f92672>&lt;td&gt;</span>
                        <span style=color:#f92672>&lt;table</span> <span style=color:#a6e22e>class=</span><span style=color:#e6db74>&#34;identify-attr-subtable&#34;</span><span style=color:#f92672>&gt;</span>
                            <span style=color:#f92672>&lt;tbody&gt;</span>
                            {% for key in attr[&#39;value&#39;] -%}
                                <span style=color:#f92672>&lt;tr&gt;</span>
                                    <span style=color:#f92672>&lt;td</span> <span style=color:#a6e22e>class=</span><span style=color:#e6db74>&#34;identify-attr-title wrap&#34;</span><span style=color:#f92672>&gt;</span>
                                        <span style=color:#f92672>&lt;i&gt;</span>{{ key }}<span style=color:#f92672>&lt;/i&gt;</span>
                                    <span style=color:#f92672>&lt;/td&gt;</span>
                                    <span style=color:#f92672>&lt;td</span> <span style=color:#a6e22e>class=</span><span style=color:#e6db74>&#34;identify-attr-value wrap&#34;</span><span style=color:#f92672>&gt;</span>
                                        {{ render_value(attr[&#39;value&#39;][key]) }}
                                    <span style=color:#f92672>&lt;/td&gt;</span>
                                <span style=color:#f92672>&lt;/tr&gt;</span>
                            {%- endfor %}
                            <span style=color:#f92672>&lt;/tbody&gt;</span>
                        <span style=color:#f92672>&lt;/table&gt;</span>
                    <span style=color:#f92672>&lt;/td&gt;</span>
                <span style=color:#f92672>&lt;/tr&gt;</span>

            {%- else -%}
                {# other attributes #}
                <span style=color:#f92672>&lt;tr&gt;</span>
                    <span style=color:#f92672>&lt;td</span> <span style=color:#a6e22e>class=</span><span style=color:#e6db74>&#34;identify-attr-title wrap&#34;</span><span style=color:#f92672>&gt;</span>
                        <span style=color:#f92672>&lt;i&gt;</span>{{ attr[&#39;alias&#39;] }}<span style=color:#f92672>&lt;/i&gt;</span>
                    <span style=color:#f92672>&lt;/td&gt;</span>
                    <span style=color:#f92672>&lt;td</span> <span style=color:#a6e22e>class=</span><span style=color:#e6db74>&#34;identify-attr-value wrap&#34;</span><span style=color:#f92672>&gt;</span>
                        {{ render_value(attr[&#39;value&#39;]) }}
                    <span style=color:#f92672>&lt;/td&gt;</span>
                <span style=color:#f92672>&lt;/tr&gt;</span>
            {%- endif %}
        {%- endfor %}
        <span style=color:#f92672>&lt;/tbody&gt;</span>
    <span style=color:#f92672>&lt;/table&gt;</span>
</code></pre></div><h2 id=db-query>DB Query</h2><p>In a DB Query the following values are replaced in the SQL:</p><ul><li><code>:x</code>: X coordinate of query</li><li><code>:y</code>: Y coordinate of query</li><li><code>:srid</code>: SRID of query coordinates</li><li><code>:resolution</code>: Resolution in map units per pixel</li><li><code>:FI_POINT_TOLERANCE</code>: Tolerance for picking points, in pixels (default=16)</li><li><code>:FI_LINE_TOLERANCE</code>: Tolerance for picking lines, in pixels (default=8)</li><li><code>:FI_POLYGON_TOLERANCE</code>: Tolerance for picking polygons, in pixels (default=4)</li><li><code>:i</code>: X ordinate of query point on map, in pixels</li><li><code>:j</code>: Y ordinate of query point on map, in pixels</li><li><code>:height</code>: Height of map output, in pixels</li><li><code>:width</code>: Width of map output, in pixels</li><li><code>:bbox</code>: &lsquo;Bounding box for map extent as minx,miny,maxx,maxy&rsquo;</li><li><code>:crs</code>: &lsquo;CRS for map extent&rsquo;</li><li><code>:feature_count</code>: Max feature count</li><li><code>:with_geometry</code>: Whether to return geometries in response (default=1)</li><li><code>:with_maptip</code>: Whether to return maptip in response (default=1)</li></ul><p>The query may return the feature ID as <code>_fid_</code> and the WKT geometry as <code>wkt_geom</code>. All other selected columns are used as feature attributes.</p><p>Sample queries:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql>    <span style=color:#66d9ef>SELECT</span> ogc_fid <span style=color:#66d9ef>as</span> _fid_, name, ...,
      ST_AsText(wkb_geometry) <span style=color:#66d9ef>as</span> wkt_geom
    <span style=color:#66d9ef>FROM</span> <span style=color:#66d9ef>schema</span>.<span style=color:#66d9ef>table</span>
    <span style=color:#66d9ef>WHERE</span> ST_Intersects(wkb_geometry, ST_GeomFromText(<span style=color:#e6db74>&#39;POINT(:x :y)&#39;</span>, :srid))
    <span style=color:#66d9ef>LIMIT</span> :feature_count;
</code></pre></div><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql>    <span style=color:#66d9ef>SELECT</span> ogc_fid <span style=color:#66d9ef>as</span> _fid_, name, ...,
      ST_AsText(wkb_geometry) <span style=color:#66d9ef>as</span> wkt_geom
    <span style=color:#66d9ef>FROM</span> <span style=color:#66d9ef>schema</span>.<span style=color:#66d9ef>table</span>
    <span style=color:#66d9ef>WHERE</span> ST_Intersects(
        wkb_geometry,
        ST_Buffer(
            ST_GeomFromText(<span style=color:#e6db74>&#39;POINT(:x :y)&#39;</span>, :srid),
            :resolution <span style=color:#f92672>*</span> :FI_POLYGON_TOLERANCE
        )
    )
    <span style=color:#66d9ef>LIMIT</span> :feature_count;
</code></pre></div><h2 id=custom-info-modules>Custom info modules</h2><p>Custom info modules can be placed in <code>./info_modules/custom/&lt;module name>/</code> and must provide the following method:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>layer_info</span>(layer, x, y, crs, params, identity)
</code></pre></div><p>Input parameters:</p><ul><li><p><code>layer</code> (str): Layer name</p></li><li><p><code>x</code> (float): X coordinate of query</p></li><li><p><code>y</code> (float): Y coordinate of query</p></li><li><p><code>crs</code> (str): CRS of query coordinates</p></li><li><p><code>params</code> (obj): FeatureInfo service params</p><pre><code>  {
      'i': &lt;X ordinate of query point on map, in pixels&gt;,
      'j': &lt;Y ordinate of query point on map, in pixels&gt;,
      'height': &lt;Height of map output, in pixels&gt;,
      'width': &lt;Width of map output, in pixels&gt;,
      'bbox': '&lt;Bounding box for map extent as minx,miny,maxx,maxy&gt;',
      'crs': '&lt;CRS for map extent&gt;',
      'feature_count': &lt;Max feature count&gt;,
      'with_geometry': &lt;Whether to return geometries in response
          (default=1)&gt;,
      'with_maptip': &lt;Whether to return maptip in response
          (default=1)&gt;,
      'FI_POINT_TOLERANCE': &lt;Tolerance for picking points, in pixels
          (default=16)&gt;,
      'FI_LINE_TOLERANCE': &lt;Tolerance for picking lines, in pixels
          (default=8)&gt;,
      'FI_POLYGON_TOLERANCE': &lt;Tolerance for picking polygons, in pixels
          (default=4)&gt;,
      'resolution': &lt;Resolution in map units per pixel&gt;
  }
</code></pre></li><li><p><code>identity</code> (str): User name or Identity dict</p></li></ul><p>Return info result as a dict:</p><pre><code>{
    'features': [
        {
            'id': &lt;feature ID&gt;,  # optional
            'attributes': [
                {
                    'name': '&lt;attribute name&gt;',
                    'value': &lt;attribute value&gt;
                }
            ],
            'bbox': [&lt;minx&gt;, &lt;miny&gt;, &lt;maxx&gt;, &lt;maxy&gt;],  # optional
            'geometry': '&lt;WKT geometry&gt;'  # optional
        }
    ]
}
</code></pre><p>See <a href=info_modules/custom/example/><code>./info_modules/custom/example/</code></a> for a sample implementation of a custom layer info module.</p><p>The custom info module can then be referenced in the <code>info_template</code> by its name (= directory name) in the service config.</p><h2 id=usage>Usage</h2><p>Set the <code>CONFIG_PATH</code> environment variable to the path containing the service config and permission files when starting this service (default: <code>config</code>).</p><p>Base URL:</p><pre><code>http://localhost:5015/
</code></pre><p>Service API:</p><pre><code>http://localhost:5015/api/
</code></pre><p>Sample request:</p><pre><code>curl 'http://localhost:5015/qwc_demo?layers=countries,edit_points&amp;i=51&amp;j=51&amp;height=101&amp;width=101&amp;bbox=671639%2C5694018%2C1244689%2C6267068&amp;crs=EPSG%3A3857'
</code></pre><h2 id=docker-usage>Docker usage</h2><p>To run this docker image you will need a PostGIS database and a running QGIS Server.</p><p>The following steps explain how to download the those services and how to run the <code>qwc-feature-info-service</code> with <code>docker-compose</code>.</p><p><strong>Step 1: Clone qwc-docker</strong></p><pre><code>git clone https://github.com/qwc-services/qwc-docker
cd qwc-docker
</code></pre><p><strong>Step 2: Create docker-compose.yml file</strong></p><pre><code>cp docker-compose-example.yml docker-compose.yml
</code></pre><p><strong>Step 3: Start docker containers</strong></p><pre><code>docker-compose up qwc-feature-info-service
</code></pre><p>For more information please visit: <a href=https://github.com/qwc-services/qwc-docker>https://github.com/qwc-services/qwc-docker</a></p><h2 id=development>Development</h2><p>Create a virtual environment:</p><pre><code>virtualenv --python=/usr/bin/python3 --system-site-packages .venv
</code></pre><p>Without system packages:</p><pre><code>virtualenv --python=/usr/bin/python3 .venv
</code></pre><p>Activate virtual environment:</p><pre><code>source .venv/bin/activate
</code></pre><p>Install requirements:</p><pre><code>pip install -r requirements.txt
</code></pre><p>Start local service:</p><pre><code>CONFIG_PATH=/PATH/TO/CONFIGS/ python server.py
</code></pre><footer class=footline></footer></div></div><div id=navigation></div></section><div style=left:-1000px;overflow:scroll;position:absolute;top:-1000px;border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px><div style=border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px></div></div><script src=/js/clipboard.min.js?1632385178></script><script src=/js/perfect-scrollbar.min.js?1632385178></script><script src=/js/perfect-scrollbar.jquery.min.js?1632385178></script><script src=/js/jquery.sticky.js?1632385178></script><script src=/js/featherlight.min.js?1632385178></script><script src=/js/highlight.pack.js?1632385178></script><script>hljs.initHighlightingOnLoad();</script><script src=/js/modernizr.custom-3.6.0.js?1632385178></script><script src=/js/learn.js?1632385178></script><script src=/js/hugo-learn.js?1632385178></script></body></html>