<!doctype html><html lang=en class="js csstransforms3d"><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=generator content="Hugo 0.68.3"><meta name=description content="Documentation QWC2 and QWC services"><link rel="shortcut icon" href=/images/favicon.ico type=image/x-icon><title>QWC Map Viewer Service :: QWC2 Documentation</title><link href=/css/nucleus.css?1632232255 rel=stylesheet><link href=/css/fontawesome-all.min.css?1632232255 rel=stylesheet><link href=/css/hybrid.css?1632232255 rel=stylesheet><link href=/css/featherlight.min.css?1632232255 rel=stylesheet><link href=/css/perfect-scrollbar.min.css?1632232255 rel=stylesheet><link href=/css/auto-complete.css?1632232255 rel=stylesheet><link href=/css/atom-one-dark-reasonable.css?1632232255 rel=stylesheet><link href=/css/theme.css?1632232255 rel=stylesheet><link href=/css/tabs.css?1632232255 rel=stylesheet><link href=/css/hugo-theme.css?1632232255 rel=stylesheet><link href=/css/theme-green.css?1632232255 rel=stylesheet><script src=/js/jquery-3.3.1.min.js?1632232255></script><style>:root #header+#content>#left>#rlblock_left{display:none!important}</style></head><body data-url=/services/qwc-map-viewer/><nav id=sidebar><div id=header-wrapper><div id=header><a id=logo href><img src=/images/qwc-logo.png height=50></a></div><div class=searchbox><label for=search-by><i class="fas fa-search"></i></label><input data-search-input id=search-by type=search placeholder=Search...>
<span data-search-clear><i class="fas fa-times"></i></span></div><script type=text/javascript src=/js/lunr.min.js?1632232255></script><script type=text/javascript src=/js/auto-complete.js?1632232255></script><script type=text/javascript>var baseurl="https:\/\/qwc.sourcepole.com\/";</script><script type=text/javascript src=/js/search.js?1632232255></script></div><section id=homelinks><ul><li><a class=padding href=/><i class="fas fa-home"></i>Home</a></li></ul></section><div class=highlightable><ul class=topics><li data-nav-id=/overview/ title=Overview class=dd-item><a href=/overview/>Overview</a></li><li data-nav-id=/quick-start/ title="Quick Start" class=dd-item><a href=/quick-start/>Quick Start</a></li><li data-nav-id=/configuration/ title=Configuration class=dd-item><a href=/configuration/>Configuration</a></li><li data-nav-id=/viewer/ title="QGIS Web Client 2" class=dd-item><a href=/viewer/>Viewer</a></li><li data-nav-id=/services/ title=Services class="dd-item
parent"><a href=/services/>Services</a><ul><li data-nav-id=/services/qwc-map-viewer/ title="QWC Map Viewer Service" class="dd-item active"><a href=/services/qwc-map-viewer/>qwc-map-viewer</a></li><li data-nav-id=/services/qwc-ogc-service/ title="QWC OGC Service" class=dd-item><a href=/services/qwc-ogc-service/>qwc-ogc-service</a></li><li data-nav-id=/services/qwc-feature-info-service/ title="QWC FeatureInfo Service" class=dd-item><a href=/services/qwc-feature-info-service/>qwc-feature-info-service</a></li><li data-nav-id=/services/qwc-fulltext-search-service/ title="QWC Fulltext Search Service" class=dd-item><a href=/services/qwc-fulltext-search-service/>qwc-fulltext-search-service</a></li><li data-nav-id=/services/qwc-legend-service/ title="QWC Legend Service" class=dd-item><a href=/services/qwc-legend-service/>qwc-legend-service</a></li><li data-nav-id=/services/qwc-permalink-service/ title="QWC Permalink Service" class=dd-item><a href=/services/qwc-permalink-service/>qwc-permalink-service</a></li><li data-nav-id=/services/qwc-print-service/ title="QWC Print service" class=dd-item><a href=/services/qwc-print-service/>qwc-print-service</a></li><li data-nav-id=/services/qwc-mapinfo-service/ title="QWC MapInfo Service" class=dd-item><a href=/services/qwc-mapinfo-service/>qwc-mapinfo-service</a></li><li data-nav-id=/services/qwc-data-service/ title="QWC Data Service" class=dd-item><a href=/services/qwc-data-service/>qwc-data-service</a></li><li data-nav-id=/services/qwc-document-service/ title="Document service" class=dd-item><a href=/services/qwc-document-service/>qwc-document-service</a></li><li data-nav-id=/services/qwc-elevation-service/ title="QWC Elevation Service" class=dd-item><a href=/services/qwc-elevation-service/>qwc-elevation-service</a></li><li data-nav-id=/services/qwc-admin-gui/ title="QWC Admin GUI" class=dd-item><a href=/services/qwc-admin-gui/>qwc-admin-gui</a></li><li data-nav-id=/services/qwc-registration-gui/ title="Registration GUI" class=dd-item><a href=/services/qwc-registration-gui/>qwc-registration-gui</a></li><li data-nav-id=/services/qwc-config-generator/ title="QWC Config Generator" class=dd-item><a href=/services/qwc-config-generator/>qwc-config-generator</a></li></ul></li><li data-nav-id=/authentication/ title=Authentication class=dd-item><a href=/authentication/>Authentication</a><ul><li data-nav-id=/authentication/qwc-db-auth/ title="DB Authentication Service" class=dd-item><a href=/authentication/qwc-db-auth/>qwc-db-auth</a></li><li data-nav-id=/authentication/qwc-ldap-auth/ title="LDAP Authentication Service" class=dd-item><a href=/authentication/qwc-ldap-auth/>qwc-ldap-auth</a></li></ul></li></ul><section id=footer></section></div></nav><section id=body><div id=overlay></div><div class="padding highlightable"><div><div id=top-bar><div id=top-github-link><a class=github-link title="Edit this page" href=https://github.com/qwc-services/qwc-website/edit/main/content/services/qwc-map-viewer.md target=blank><i class="fas fa-code-branch"></i><span id=top-github-link-text>Edit this page</span></a></div><div id=breadcrumbs itemscope itemtype=http://data-vocabulary.org/Breadcrumb><span id=sidebar-toggle-span><a href=# id=sidebar-toggle data-sidebar-toggle><i class="fas fa-bars"></i></a></span><span id=toc-menu><i class="fas fa-list-alt"></i></span><span class=links><a href=/>QWC2 / QWC Services</a> > <a href=/services/>Services</a> > QWC Map Viewer Service</span></div><div class=progress><div class=wrapper><nav id=TableOfContents><ul><li><a href=#setup>Setup</a></li><li><a href=#configuration>Configuration</a><ul><li><a href=#map-viewer-config>Map Viewer config</a></li><li><a href=#permissions>Permissions</a></li></ul></li><li><a href=#usage>Usage</a></li><li><a href=#docker-usage>Docker usage</a><ul><li><a href=#run-docker-image>Run docker image</a></li></ul></li><li><a href=#development>Development</a></li></ul></nav></div></div></div></div><div id=head-tags></div><div id=body-inner><h1>QWC Map Viewer Service</h1><p>Provide a <a href=https://github.com/qgis/qwc2-demo-app>QWC2 Web Client</a> application using QWC services.</p><p><strong>Note:</strong> Requires a QWC OGC service or QGIS server running on <code>ogc_service_url</code>. Additional QWC Services are optional.</p><h2 id=setup>Setup</h2><p>Copy your QWC2 files from a production build (see <a href=https://github.com/qgis/qwc2-demo-app/blob/master/doc/QWC2_Documentation.md#quick-start>QWC2 Quick start</a>):</p><pre><code>SRCDIR=path/to/qwc2-app/prod/ DSTDIR=$PWD
mkdir $DSTDIR/qwc2 &amp;&amp; mkdir $DSTDIR/qwc2/dist
cd $SRCDIR &amp;&amp; \
cp -r assets $DSTDIR/qwc2 &amp;&amp; \
cp -r translations $DSTDIR/qwc2/translations &amp;&amp; \
cp dist/QWC2App.js $DSTDIR/qwc2/dist/ &amp;&amp; \
cp index.html $DSTDIR/qwc2/ &amp;&amp; \
cp config.json $DSTDIR/qwc2/config.json &amp;&amp; \
cd -
</code></pre><h2 id=configuration>Configuration</h2><p>The static config and permission files are stored as JSON files in <code>$CONFIG_PATH</code> with subdirectories for each tenant,
e.g. <code>$CONFIG_PATH/default/*.json</code>. The default tenant name is <code>default</code>.</p><p><strong>Note:</strong>: Custom viewers have been replaced by tenants in v2.</p><h3 id=map-viewer-config>Map Viewer config</h3><ul><li><a href=schemas/qwc-map-viewer.json>JSON schema</a></li><li>File location: <code>$CONFIG_PATH/&lt;tenant>/mapViewerConfig.json</code></li></ul><p>Example:</p><pre><code class=language-jsonc data-lang=jsonc>{
  &quot;$schema&quot;: &quot;https://raw.githubusercontent.com/qwc-services/qwc-map-viewer/v2/schemas/qwc-map-viewer.json&quot;,
  &quot;service&quot;: &quot;map-viewer&quot;,
  &quot;config&quot;: {
    // path to QWC2 files
    &quot;qwc2_path&quot;: &quot;qwc2/&quot;,
    // QWC OGC service (required)
    &quot;ogc_service_url&quot;: &quot;http://localhost:5013/&quot;,
    // some optional QWC services
    &quot;auth_service_url&quot;: &quot;http://localhost:5017/&quot;,
    &quot;data_service_url&quot;: &quot;http://localhost:5012/&quot;
  },
  &quot;resources&quot;: {
    &quot;qwc2_config&quot;: {
      // restricted menu items
      &quot;restricted_viewer_tasks&quot;: [&quot;RasterExport&quot;],

      &quot;config&quot;: {
        // contents from QWC2 config.json
        &quot;assetsPath&quot;: &quot;/assets&quot;,
        // ...
      }
    },
    &quot;qwc2_themes&quot;: {
      // contents from QWC2 themes.json
      &quot;themes&quot;: {
        &quot;items&quot;: [
          {
            &quot;name&quot;: &quot;qwc_demo&quot;,
            &quot;title&quot;: &quot;Demo&quot;,
            &quot;url&quot;: &quot;/ows/qwc_demo&quot;,
            // ...
            &quot;sublayers&quot;: [
              // ...
            ]
          }
        ],
        &quot;backgroundLayers&quot;: [
          // ...
        ],
        // ...
      }
    }
  }
}
</code></pre><p>All <code>config</code> options may be overridden by setting corresponding upper-case environment variables, e.g. <code>OGC_SERVICE_URL</code> for <code>ogc_service_url</code>.</p><p>Main optional QWC services:</p><ul><li><code>auth_service_url</code>: QWC Auth Service URL</li><li><code>data_service_url</code>: QWC Data Service URL</li><li><code>elevation_service_url</code>: QWC Elevation Service URL</li><li><code>info_service_url</code>: QWC FeatureInfo Service URL</li><li><code>legend_service_url</code>: QWC Legend Service URL</li><li><code>permalink_service_url</code>: QWC Permalink Service URL</li><li><code>print_service_url</code>: QWC Print Service URL</li><li><code>proxy_service_url</code>: Proxy Service URL</li><li><code>search_service_url</code>: QWC Search Service URL</li><li><code>search_data_service_url</code>: QWC Search Result Service URL</li></ul><p><code>qwc2_config</code> contains the QWC2 application configuration, with <code>config</code> corresponding to the contents of your standalone <code>config.json</code> file (see <a href=https://github.com/qgis/qwc2-demo-app/blob/master/doc/QWC2_Documentation.md#application-configuration-the-configjson-and-jsappconfigjs-files>Documentation</a>).</p><p><code>qwc2_themes</code> contains the full themes configuration, corresponding to the contents of your standalone <code>themes.json</code> collected from <code>themesConfig.json</code>.</p><p>Add new themes to your <code>themesConfig.json</code> (see <a href=https://github.com/qgis/qwc2-demo-app/blob/master/doc/QWC2_Documentation.md#theme-configuration-qgis-projects-and-the-themesconfigjson-file>Documentation</a>) and put any theme thumbnails into <code>$QWC2_PATH/assets/img/mapthumbs/</code>.
The <code>themesConfig.json</code> file is used to collect the full themes configuration using GetProjectSettings.</p><h3 id=permissions>Permissions</h3><ul><li>File location: <code>$CONFIG_PATH/&lt;tenant>/permissions.json</code></li></ul><p>Example:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json>{
  <span style=color:#f92672>&#34;users&#34;</span>: [
    {
      <span style=color:#f92672>&#34;name&#34;</span>: <span style=color:#e6db74>&#34;demo&#34;</span>,
      <span style=color:#f92672>&#34;groups&#34;</span>: [<span style=color:#e6db74>&#34;demo&#34;</span>],
      <span style=color:#f92672>&#34;roles&#34;</span>: []
    }
  ],
  <span style=color:#f92672>&#34;groups&#34;</span>: [
    {
      <span style=color:#f92672>&#34;name&#34;</span>: <span style=color:#e6db74>&#34;demo&#34;</span>,
      <span style=color:#f92672>&#34;roles&#34;</span>: [<span style=color:#e6db74>&#34;demo&#34;</span>]
    }
  ],
  <span style=color:#f92672>&#34;roles&#34;</span>: [
    {
      <span style=color:#f92672>&#34;role&#34;</span>: <span style=color:#e6db74>&#34;public&#34;</span>,
      <span style=color:#f92672>&#34;permissions&#34;</span>: {
        <span style=color:#f92672>&#34;viewer_tasks&#34;</span>: [],
        <span style=color:#f92672>&#34;wms_services&#34;</span>: [
          {
            <span style=color:#f92672>&#34;name&#34;</span>: <span style=color:#e6db74>&#34;qwc_demo&#34;</span>,
            <span style=color:#f92672>&#34;layers&#34;</span>: [
              {
                <span style=color:#f92672>&#34;name&#34;</span>: <span style=color:#e6db74>&#34;qwc_demo&#34;</span>
              },
              {
                <span style=color:#f92672>&#34;name&#34;</span>: <span style=color:#e6db74>&#34;edit_demo&#34;</span>
              },
              {
                <span style=color:#f92672>&#34;name&#34;</span>: <span style=color:#e6db74>&#34;edit_points&#34;</span>
              },
              {
                <span style=color:#f92672>&#34;name&#34;</span>: <span style=color:#e6db74>&#34;edit_lines&#34;</span>
              },
              {
                <span style=color:#f92672>&#34;name&#34;</span>: <span style=color:#e6db74>&#34;edit_polygons&#34;</span>
              },
              {
                <span style=color:#f92672>&#34;name&#34;</span>: <span style=color:#e6db74>&#34;geographic_lines&#34;</span>
              },
              {
                <span style=color:#f92672>&#34;name&#34;</span>: <span style=color:#e6db74>&#34;country_names&#34;</span>
              },
              {
                <span style=color:#f92672>&#34;name&#34;</span>: <span style=color:#e6db74>&#34;states_provinces&#34;</span>
              },
              {
                <span style=color:#f92672>&#34;name&#34;</span>: <span style=color:#e6db74>&#34;countries&#34;</span>
              },
              {
                <span style=color:#f92672>&#34;name&#34;</span>: <span style=color:#e6db74>&#34;bluemarble_bg&#34;</span>
              },
              {
                <span style=color:#f92672>&#34;name&#34;</span>: <span style=color:#e6db74>&#34;osm_bg&#34;</span>
              }
            ],
            <span style=color:#f92672>&#34;print_templates&#34;</span>: [<span style=color:#e6db74>&#34;A4 Landscape&#34;</span>]
          }
        ],
        <span style=color:#f92672>&#34;background_layers&#34;</span>: [<span style=color:#e6db74>&#34;bluemarble&#34;</span>, <span style=color:#e6db74>&#34;mapnik&#34;</span>],
        <span style=color:#f92672>&#34;data_datasets&#34;</span>: [
          {
            <span style=color:#f92672>&#34;name&#34;</span>: <span style=color:#e6db74>&#34;qwc_demo.edit_points&#34;</span>,
            <span style=color:#f92672>&#34;attributes&#34;</span>: [
              <span style=color:#e6db74>&#34;id&#34;</span>, <span style=color:#e6db74>&#34;name&#34;</span>, <span style=color:#e6db74>&#34;description&#34;</span>, <span style=color:#e6db74>&#34;num&#34;</span>, <span style=color:#e6db74>&#34;value&#34;</span>, <span style=color:#e6db74>&#34;type&#34;</span>, <span style=color:#e6db74>&#34;amount&#34;</span>, <span style=color:#e6db74>&#34;validated&#34;</span>, <span style=color:#e6db74>&#34;datetime&#34;</span>
            ]
          }
        ]
      }
    },
    {
      <span style=color:#f92672>&#34;role&#34;</span>: <span style=color:#e6db74>&#34;demo&#34;</span>,
      <span style=color:#f92672>&#34;permissions&#34;</span>: {
        <span style=color:#f92672>&#34;viewer_tasks&#34;</span>: [<span style=color:#e6db74>&#34;RasterExport&#34;</span>]
      }
    }
  ]
}
</code></pre></div><ul><li><code>viewer_tasks</code>: permitted menu items if any are restricted</li><li><code>wms_services</code>: permitted WMS services, layers and print templates</li><li><code>background_layers</code>: permitted background layers</li><li><code>data_datasets</code>: permitted datasets for editing</li></ul><p>In this example, the <em>Raster Export</em> map tool will only be visible for users with the role <code>demo</code>.</p><h2 id=usage>Usage</h2><p>Set the <code>CONFIG_PATH</code> environment variable to the path containing the service config and permission files when starting this service (default: <code>config</code>).</p><p>Base URL:</p><pre><code>http://localhost:5030/
</code></pre><p>Sample requests:</p><pre><code>curl 'http://localhost:5030/config.json'
curl 'http://localhost:5030/themes.json'
</code></pre><h2 id=docker-usage>Docker usage</h2><h3 id=run-docker-image>Run docker image</h3><p>To run this docker image you will need the following three additional services:</p><ul><li>qwc-postgis</li><li>qwc-qgis-server</li><li>qwc-ogc-service</li><li>qwc-data-service</li></ul><p>Those services can be found under <a href=https://github.com/qwc-services/>https://github.com/qwc-services/</a>. The following steps explain how to download those services and how to run the <code>qwc-map-viewer</code> with <code>docker-compose</code>.</p><p><strong>Step 1: Clone qwc-docker</strong></p><pre><code>git clone https://github.com/qwc-services/qwc-docker
cd qwc-docker
</code></pre><p><strong>Step 2: Create docker-compose.yml file</strong></p><pre><code>cp docker-compose-example.yml docker-compose.yml
</code></pre><p><strong>Step 3: Choose between a version of the qwc-map-viewer</strong></p><h4 id=qwc-map-viewer-demo>qwc-map-viewer-demo</h4><p>This is the demo version used in the <code>docker-compose-example.yml</code> file. With this version, the docker image comes with a preinstalled version of the latest qwc2-demo-app build and the python application for the viewer. Use this docker image, if you don&rsquo;t have your own build of the QWC2 app.</p><h4 id=qwc-map-viewer-base>qwc-map-viewer-base</h4><p>If you want to use your own QWC2 build then this is the docker image that you want to use. This docker image comes with only the python application installed on. Here is an example, on how you can add you own QWC2 build to the docker image:</p><pre><code>qwc-map-viewer:
    image: sourcepole/qwc-map-viewer-base
    ports:
        - &quot;127.0.0.1:5030:9090&quot;
    # Here you mount your own QWC2 build
    volumes:
        - /PATH_TO_QWC2_BUILD/:/qwc2:ro
        - /PATH_TO_CONFIG:/srv/qwc_service/config:ro
</code></pre><p><strong>Step 4: Start docker containers</strong></p><pre><code>docker-compose up qwc-map-viewer
</code></pre><p>For more information please visit: <a href=https://github.com/qwc-services/qwc-docker>https://github.com/qwc-services/qwc-docker</a></p><h2 id=development>Development</h2><p>Create a virtual environment:</p><pre><code>virtualenv --python=/usr/bin/python3 --system-site-packages .venv
</code></pre><p>Without system packages:</p><pre><code>virtualenv --python=/usr/bin/python3 .venv
</code></pre><p>Activate virtual environment:</p><pre><code>source .venv/bin/activate
</code></pre><p>Install requirements:</p><pre><code>pip install -r requirements.txt
</code></pre><p>Start local service:</p><pre><code>CONFIG_PATH=/PATH/TO/CONFIGS/ python server.py
</code></pre><footer class=footline></footer></div></div><div id=navigation></div></section><div style=left:-1000px;overflow:scroll;position:absolute;top:-1000px;border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px><div style=border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px></div></div><script src=/js/clipboard.min.js?1632232255></script><script src=/js/perfect-scrollbar.min.js?1632232255></script><script src=/js/perfect-scrollbar.jquery.min.js?1632232255></script><script src=/js/jquery.sticky.js?1632232255></script><script src=/js/featherlight.min.js?1632232255></script><script src=/js/highlight.pack.js?1632232255></script><script>hljs.initHighlightingOnLoad();</script><script src=/js/modernizr.custom-3.6.0.js?1632232255></script><script src=/js/learn.js?1632232255></script><script src=/js/hugo-learn.js?1632232255></script></body></html>